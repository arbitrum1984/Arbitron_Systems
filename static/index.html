<!DOCTYPE html>
<!--
Module: static/index.html

Description:
    Main single-page application HTML shell for Arbitron Systems v2.0.
    This document provides the structural layout and markup for the
    client application: a persistent sidebar with session navigation
    and controls, a central chat panel, a resizable desktop area for
    trading widgets and a 3D quant window, and modal dialogs for
    voice input, favorites (watchlist), and settings.

Usage:
    The page depends on several third-party client libraries (Vue,
    Plotly, marked, TradingView) and loads the application bundle at
    `/static/app.js`. Ensure the web server serves the `/static`
    directory when running the backend.

Notes:
    The inline comments that follow describe major sections for
    maintainers and aim to aid future extension and testing. This
    header is intentionally descriptive and written in a formal,
    academic style to assist documentation generation and review.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARBI OS v2.0</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <div id="app">
        
        <!--
            Sidebar

            Purpose:
                Provides primary navigation and quick-access controls
                for the application: create new chat sessions, view
                session history, and access auxiliary panes (voice,
                favorites, 3D window, settings).

            Notes:
                - The visual icons are implemented as inline SVG for
                  portability. Event handlers are bound via Vue
                  directives in `/static/app.js`.
        -->
        <!-- SIDEBAR -->
        <div class="sidebar">
            <img src="/static/assets/logo.ico" style="width: 32px; height: 32px; margin-bottom: 20px;">
            <div class="nav-item" @click="createNewChat" title="New Session">
                <svg class="icon-svg" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </div>
            <!-- HISTORY -->
            <div class="history-list" style="flex-grow: 1; overflow-y: auto; width: 100%; display: flex; flex-direction: column; align-items: center; border-top: 1px solid #333; border-bottom: 1px solid #333; padding: 10px 0;">
                <div v-for="chat in chatSessions" :key="chat.id" class="history-item" :class="{ active: chat.id === currentChatId }" @click="switchChat(chat.id)" :title="chat.title">
                    <svg class="icon-svg" viewBox="0 0 24 24" style="width:18px; height:18px; opacity:0.7;"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    <!-- Chat removal -->
                    <div class="del-btn" @click.stop="deleteChat(chat.id)" title="Delete">
                        <svg class="del-icon-svg" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </div>
                </div>
            </div>
            <!-- Icons -->
            <div class="nav-item" @click="toggleVoice"><svg class="icon-svg" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg></div>
            <div class="nav-item" @click="showFavorites = true"><svg class="icon-svg" viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg></div>
            <div class="nav-item" @click="show3DWindow"><svg class="icon-svg" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div>
            <div class="nav-item" @click="showSettings = true"><svg class="icon-svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></div>
        </div>

        <!--
            Chat Panel

            Purpose:
                Hosts the conversational UI: message history, input
                field, and loading indicators. Messages are rendered
                via Vue bindings and support markdown rendering and
                widget placeholders produced by assistant responses.
        -->
        <!-- CHAT PANEL -->
        <div class="chat-panel" id="chat-panel">
            <div class="chat-header"><span>SESSION: {{ currentChatId ? currentChatId.slice(-4) : 'NULL' }}</span><div class="status-indicator"></div></div>
            <div class="chat-container" id="chat-box">
                <div v-if="messages.length === 0" style="opacity:0.3; margin-top:50px; text-align:center;">SYSTEM READY.</div>
                <div v-for="(msg, index) in messages" :key="index" class="message" :class="msg.role">
                    <div class="msg-header">[{{ msg.role === 'user' ? 'OPERATOR' : 'ARBI_CORE' }}]:</div>
                    <div class="msg-content" v-html="renderMarkdown(msg.content)"></div>
                </div>
                <div v-if="isLoading" class="message assistant"><div class="msg-header">[SYSTEM]:</div><span style="color:#00A3E0;">Researching...</span></div>
            </div>
            <div class="input-zone"><div class="input-bar"><span class="prompt-symbol">>_</span><input type="text" class="text-field" v-model="input" @keyup.enter="sendMessage" placeholder="Enter command..." autocomplete="off" autofocus></div></div>
        </div>

        <!--
            Resizer

            Purpose:
                Small draggable divider that enables the user to
                resize the left chat panel (sidebar) and the
                desktop/dashboard area. Mouse events are handled in
                `/static/app.js`.
        -->
        <!-- RESIZER -->
        <div class="resizer" id="resizer"></div>

        <!--
            Desktop Area / Dashboard Panel

            Purpose:
                Freely-positioned widgets (chart cards) are created
                here for each favorite ticker. A dedicated 3D window
                contains the quant model visualization rendered by
                Plotly when initialized.
        -->
        <!-- DESKTOP AREA -->
        <div class="dashboard-panel" id="desktop-area">
            <!-- 3D Window -->
            <div id="window-3d" class="chart-card" style="top: 20px; left: 20px; width: 500px; height: 350px; display: none;">
                <div class="chart-title-bar">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:14px; height:14px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                        <span>QUANT_MODEL</span>
                        <select v-model="selected3DTicker" style="background:#1a1a1a; color:white; border:none; font-family:inherit; font-size:10px;" @mousedown.stop>
                            <option v-for="t in favorites" :key="t" :value="t">{{ t }}</option>
                            <option value="SPY">SPY</option>
                        </select>
                    </div>
                    <!--  Initialization button -->
                    <span class="chart-remove-btn" onclick="document.getElementById('window-3d').style.display='none'">
                        <svg class="del-icon-svg" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </span>
                </div>
                <div id="quant-chart" class="tv-widget-container"></div>
                <!-- Loading button-->
                <div v-if="!is3DLoaded" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
                    <button class="modal-btn" @click="fetch3DData">INIT MODEL</button>
                </div>
            </div>
        </div>

        <!--
            Modals

            Purpose:
                Overlaid dialogs used for voice input, watchlist
                management, and settings. These are implemented as
                simple conditional containers controlled by Vue
                reactive state.
        -->
        <!-- MODALS -->
        <div v-if="showVoice" class="modal-mask" @click.self="showVoice = false"><div class="modal-body" style="text-align:center;"><h3>VOICE UPLINK</h3><div style="width:60px; height:60px; background:#00A3E0; border-radius:50%; margin:20px auto; display:flex; align-items:center; justify-content:center;"><svg class="icon-svg" viewBox="0 0 24 24" style="color:white; width:30px; height:30px;"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path></svg></div><div>{{ voiceStatusText }}</div></div></div>
        <div v-if="showFavorites" class="modal-mask" @click.self="showFavorites = false"><div class="modal-body"><h3>WATCHLIST</h3><input type="text" v-model="newFav" @keyup.enter="addFavorite" style="width:100%; padding:10px; background:#000; border:1px solid #333; color:white;"><div style="margin-top:15px;"><div v-for="t in favorites" :key="t" style="padding:5px 0; display:flex; justify-content:space-between; border-bottom:1px solid #222;"><span>{{ t }}</span><span @click="removeFavorite(t)" style="color:#cf6679; cursor:pointer;"><svg class="del-icon-svg" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></span></div></div></div></div>
        <div v-if="showSettings" class="modal-mask" @click.self="showSettings = false"><div class="modal-body"><h3>SETTINGS</h3><button class="modal-btn" @click="showSettings = false">CLOSE</button></div></div>
    </div>
    <script src="/static/app.js"></script>
</body>
</html>